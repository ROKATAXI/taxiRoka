{% extends 'base.html' %}
{% load static %}


{% block title %}
<!-- <link rel="stylesheet" href="{% static 'css/matching_list.css' %}" type="text/css"/> -->
{% endblock %}

{% block content %}
<div class="mainpage">
    <!-- 날짜 -->
    <div class="date-container">
        <!-- 날짜 -->
        <button type="button" class="btn btn-success search-dateall">전체</button>
        <div class="calendar-scroll-container">
            <!-- 날짜와 이벤트를 표시할 부분 -->
            <div class="calendar-content">
                <!-- 일단 하드코딩 해놓음. 오늘 날짜 받아와서 그거 기준으로 요일이랑 날짜 변경 -->
                {% for day in "dddddddddddddddddd" %}
                    <div>
                        <p>5</p><p>일</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- 방목록 -->
    <div class="matchinglist-container">
        <div class="matchingroom-container">
            <div class="selected_date">
                <form action="{% url 'matching:main' %}" method="get">
                    <label for="selected_date"></label>
                    <input type="date" class="main-date-input" id="selected_date" name="selected_date" value="{{request.Get.selected_date}}">
                    <input type="submit" value="선택">
                    
                </form>
            </div>
            <!-- 부대위치와 방생성 -->
            <div class="matchinglist-info">
                {% if user.is_authenticated %}
                    <!-- 로그인한 사용자의 경우에만 보여질 내용 -->
                    <p>{{ user.first_name }}님</p>
                {% else %}
                    <a href="/user/main/">로그인</a>
                {% endif %}
                <a href="/matching/create/"><button class="btn btn-secondary">방 만들기</button></a>
            </div>
        
            {% for room in rooms %}
            <div class="matching-room" data-bs-toggle="modal" data-bs-target="#exampleModal-{{ room.id }}">
                <div class="matching-room--left">
                    <div>
                        {{ room.departure_date }}
                    </div>
                    <div>{{ room.departure_time }}</div>
                    <div>
                       {{ room.current_num }} / {{ room.max_num }}
                    </div>
                    <div>
                        
                    </div>

                </div>
                <div class="matching-room--right">
                    <div class="matching--departure">
                        <span>출발: {{ room.departure_area }}</span>
                        <span>도착: {{ room.destination_area }}</span>
                        {% if room in is_host %}
                            <div class="host-icon-box">
                                <div class="host-icon"></div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
            </div>
            
            {% endfor %}

            <!-- Modals -->
            {% for room in rooms %}
            <div class="modal fade" id="exampleModal-{{ room.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel"></h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        {% if room in is_host %} <!--해당 방의 방장일 때-->
                        <div class="matchinglist-modal-body">
                            <img class="taxiimg" src="{% static 'img/taxiimg.png' %}">
                            <h3>매칭방을<br>수정하시겠습니까?</h3>
                        </div>
                        <div class="matchinglist-modal-footer">                            
                            <a href="/matching/update/room/{{ room.id }}"><button type="button" class="btn btn-primary" id="matching-button">수정</button></a>
                        </div>    
                        {% else %} <!--해당 방의 게스트일 때-->
                        <div class="matchinglist-modal-body">
                            <img class="taxiimg" src="{% static 'img/taxiimg.png' %}">
                            <h3>매칭에<br>참여하시겠습니까?</h3>
                        </div>
                        <div class="matchinglist-modal-footer">   
                            <a href="/matching/apply/room/{{ room.id }}"><button type="button" class="btn btn-primary" id="matching-button">매칭 참여하기</button></a>
                        </div>    
                        {% endif %}     
                            <!--<script>
                                $(document).ready(function() {
                                    $(".matching-room").click(function() {
                                        var alreadyApply = {{ already_apply|yesno:"true,false" }};
                                        var currentNum = {{ room.current_num }};
                                        var maxNum = {{ room.max_num }};
                                        
                                        if (alreadyApply || currentNum === maxNum) {
                                            alert("매칭방이 가득 찼거나 이미 신청하셨습니다.");
                            
                                        }
                                    });
                                });
                            </script>       -->                                                      
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
